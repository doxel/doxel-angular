
<div class="view" id="segments">

  <div class="tree">
    <ul class="year" ng-if="viewMode=='tree'">
      <li ng-repeat="(year, month) in tree">
        <a ng-click="toggle($event,year)">
          <i ng-class="expanded[year] ? 'fa fa-caret-down' : 'fa fa-caret-right'"></i>
          <i ng-class="expanded[year] ? 'fa fa-folder-open' : 'fa fa-folder'"></i>
          <span>{{year}}</span>
        </a>
        <ul class="month" ng-if="expanded[year]">
          <li ng-repeat="(month, day) in tree[year]" ng-init="ym=year+month; ym2=year+'.'+month">
            <a ng-click="toggle($event,ym2)">
              <i ng-class="expanded[ym] ? 'fa fa-caret-down' : 'fa fa-caret-right'"></i>
              <i ng-class="expanded[ym] ? 'fa fa-folder-open' : 'fa fa-folder'"></i>
              <span>{{month}}</span>
            </a>
            <ul class="day" ng-if="expanded[ym]">
              <li ng-repeat="(day, timestamp) in tree[year][month]" ng-init="ymd=ym+day; ymd2=ym2+'.'+day">
                <a ng-click="toggle($event,ymd2)">
                  <i ng-class="expanded[ymd] ? 'fa fa-caret-down' : 'fa fa-caret-right'"></i>
                  <i ng-class="expanded[ymd] ? 'fa fa-folder-open' : 'fa fa-folder'"></i>
                  <span>{{day}}<span>
                </a>
                <ul class="timestamp" ng-if="expanded[ymd]">
                  <li ng-repeat="(timestamp, segmentId) in tree[year][month][day]" ng-init="ymdt=ymd+timestamp; ymdt2=ymd2+'.'+timestamp">
                    <a ng-click="toggle($event,ymdt2)">
                      <i ng-class="expanded[ymdt] ? 'fa fa-caret-down' : 'fa fa-caret-right'"></i>
                      <i ng-class="expanded[ymdt] ? 'fa fa-folder-open' : 'fa fa-folder'"></i>
                      <span>{{timestamp | formatTimestamp : 'hms'}}</span>
                    </a>
                    <ul class="segmentId" ng-if="expanded[ymdt]">
                      <li ng-repeat="(segmentId, segment) in tree[year][month][day][timestamp]" ng-init="ymdts=ymdt+segmentId; ymdts2=ymdt2+'.'+segmentId">
                        <a ng-click="toggle($event,ymdts2)">
                          <i ng-class="expanded[ymdts] ? 'fa fa-caret-down' : 'fa fa-caret-right'"></i>
                          <i ng-class="expanded[ymdts] ? 'fa fa-folder-open' : 'fa fa-folder'"></i>
                        <span>{{segmentId}}</span>
                        </a>
                        <ul class="picture" ng-if="expanded[ymdts]">
                          <li ng-repeat="(index, picture) in tree[year][month][day][timestamp][segmentId]" ng-init="ymdtsp=ymdts+picture.id; ymdtsp2=ymdts2+'.'+picture.id">
                            <a ng-click="toggle($event,ymdtsp2,index)">
                              <!--i ng-class="expanded[year+month+day+timestamp+segmentId+picture.id] ? 'fa fa-caret-down' : 'fa fa-caret-right'"></i-->
                              <i class="fa"></i>
                              <i class="fa fa-file-image-o"></i>
                              <span>{{picture.timestamp | formatTimestamp : 'hms'}}</span>
                            </a>
                            <ul class="picture_detail">
                              <li></li>
                            </ul>
                          </li>
                        </ul>
                      </li>
                    </ul>
                  </li>
                </ul>
              </li>
            </ul>
          </li>
        </ul>
      </li>
    </ul>
  </div>

  <div ng-if="viewMode=='list'">
    <table ng-table="tableParams" show-filter="true" class="table table-condensed table-bordered table-striped">
      <col width="30%"></col>
      <col width="70%"></col>
      <tr class="ng-table-group" ng-repeat-start="group in $groups" ng-init="group.$show=false">
        <td colspan="2">
          <a ng-click="group.$show = !group.$show">
            <span class="glyphicon" ng-class="{ 'glyphicon-chevron-right': !group.$show, 'glyphicon-chevron-down': group.$show }"></span>
            <strong>{{ group.value + (group.data.length>1?' (' + group.data.length + ')':'') }}</strong>
          </a>
        </td>
      </tr>

      <!--tr ng-controller="SegmentsCtrl" ng-if="group.$show" ng-repeat="segment in group.data" ng-repeat-end ondragstart="segmentsCtrl._dragstart(event)" ondragend="segmentsCtrl.dragend(event)" ondragover="segmentsCtrl._dragover(event)" ondragenter="segmentsCtrl.dragenter(event)" ondragLeave="segmentsCtrl.dragleave(event)" ondrop="segmentsCtrl.ondrop(event)" draggable="true"-->
      <tr ng-if="group.$show" ng-repeat="segment in group.data" ng-repeat-end dnd="true">
      <td data-title="'Date'" groupable="'_timestamp'" filter="{ '_timestamp': 'text' }" sortable="'timestamp'"  segment-preview="segment" segment-preview-class="thumb"></td>
        <td data-title="'Details'" segment-details="segment"></td>
      </tr>
    </table>
  </div>

  <div ng-if="viewMode=='tree'" class="details">
    <div ng-if="view=='year'" class="year">
    </div>
    <div ng-if="view=='month'" class="month">
    </div>
    <div ng-if="view=='day'" class="day">
    </div>
    <div ng-if="view=='timestamp'" class="timestamp">
    </div>
    <div ng-if="view=='segment'" class="segment">
      <div class="segment_preview" segment-preview="segment" segment-preview-class="thumb"></div>
      <div segment-details="segment"></div>
    </div>
    <div ng-if="view=='picture'" class="picture">
      <img ng-src="{{blob}}" dom-onload="imgloaded($event)">
    </div>
  </div>

</div>
